# タスク一覧: テクニカル指標計算精度向上

## Phase 1: 基盤修正（高優先度）

### Task 1.1: Calculator基盤の修正
- **ID**: `calc-base-fix`
- **優先度**: 🔴 高
- **概要**: Calculator.exponentialMovingAverageを業界標準実装に修正
- **詳細タスク**:
  - [ ] EMA初期値を最初のperiod分の単純平均に変更
  - [ ] 入力検証の追加（period <= 0, 空配列など）
  - [ ] 戻り値の調整（period-1以降のみ返却）
  - [ ] 既存テストケースの調整
- **影響範囲**: MACD, RSI, 移動平均の全計算に影響
- **完了条件**: 修正版EMAが標準的な計算結果を出力
- **状態**: ⏳ 未着手

### Task 1.2: 共通バリデーション基盤の作成
- **ID**: `validation-base`
- **優先度**: 🔴 高
- **概要**: 全指標で共通利用するバリデーション関数を作成
- **詳細タスク**:
  - [ ] ValidationUtilsクラスの作成
  - [ ] validatePricesArray関数の実装
  - [ ] validatePeriod関数の実装
  - [ ] CalculationErrorインターフェースの拡張
- **完了条件**: 全バリデーション関数が正しく動作
- **状態**: ⏳ 未着手

### Task 1.3: エラーハンドリング基盤の強化
- **ID**: `error-handling-base`
- **優先度**: 🟡 中
- **概要**: エラー分類とハンドリング機構の整備
- **詳細タスク**:
  - [ ] エラーコードの標準化
  - [ ] エラーメッセージの多言語対応準備
  - [ ] デバッグ用詳細情報の追加
- **完了条件**: 統一されたエラーハンドリングが動作
- **状態**: ⏳ 未着手

---

## Phase 2: MACD修正（最重要）

### Task 2.1: MACD計算ロジックの修正
- **ID**: `macd-index-fix`
- **優先度**: 🔴 最重要
- **概要**: MACDのインデックスずれ問題を修正
- **詳細タスク**:
  - [ ] 同一日付のEMA値で差分計算に修正
  - [ ] macdLine計算ロジックの書き直し
  - [ ] 配列長の調整とアライメント
  - [ ] データ不足時の適切なエラー処理追加
- **完了条件**: 正確な日付でのMACD計算が実行される
- **状態**: ⏳ 未着手

### Task 2.2: MACD calculateArray修正
- **ID**: `macd-array-fix`
- **優先度**: 🔴 高
- **概要**: MACD配列計算の同様な問題を修正
- **詳細タスク**:
  - [ ] calculateArrayメソッドのインデックス修正
  - [ ] ヒストグラム計算の調整
  - [ ] 配列長の整合性確保
- **完了条件**: 配列版MACDも正確な計算結果を出力
- **状態**: ⏳ 未着手

### Task 2.3: MACD専用テストの強化
- **ID**: `macd-test-enhance`
- **優先度**: 🟡 中
- **概要**: MACD修正内容の詳細テスト
- **詳細タスク**:
  - [ ] 手計算による既知解答データの作成
  - [ ] TradingView等との比較テスト追加
  - [ ] エッジケーステストの追加
  - [ ] 修正前後の結果比較テスト
- **完了条件**: MACD計算の正確性が十分に検証される
- **状態**: ⏳ 未着手

---

## Phase 3: 包括的改善（中優先度）

### Task 3.1: RSI計算の強化
- **ID**: `rsi-enhance`
- **優先度**: 🟡 中
- **概要**: RSI計算のエッジケース処理を強化
- **詳細タスク**:
  - [ ] warmupPeriod < period の場合の調整
  - [ ] avgGain === 0 && avgLoss === 0 ケースの処理追加
  - [ ] データ不足時の明確なエラー処理
  - [ ] 入力パラメータの厳密な検証
- **完了条件**: RSIが全エッジケースで適切に動作
- **状態**: ⏳ 未着手

### Task 3.2: 移動平均計算の最適化
- **ID**: `ma-optimize`
- **優先度**: 🟢 低
- **概要**: 移動平均計算の効率性向上
- **詳細タスク**:
  - [ ] SMA計算のウィンドウ処理最適化
  - [ ] 不要な配列生成の削減
  - [ ] メモリ使用量の改善
  - [ ] エラーハンドリングの統一
- **完了条件**: 移動平均の計算速度とメモリ効率が向上
- **状態**: ⏳ 未着手

### Task 3.3: 全指標のエラーケーステスト追加
- **ID**: `error-case-tests`
- **優先度**: 🟡 中
- **概要**: 各指標のエラーケース網羅テスト
- **詳細タスク**:
  - [ ] 空配列、null、undefined入力テスト
  - [ ] 不正パラメータ（0、負数、非整数）テスト
  - [ ] データ不足パターンテスト
  - [ ] 極端な値（Infinity、NaN）テスト
- **完了条件**: 全エラーケースで適切な処理が動作
- **状態**: ⏳ 未着手

---

## Phase 4: 最適化と仕上げ（低優先度）

### Task 4.1: パフォーマンス測定と改善
- **ID**: `performance-improve`
- **優先度**: 🟢 低
- **概要**: 大量データでのパフォーマンス測定と改善
- **詳細タスク**:
  - [ ] 現状のパフォーマンス測定（ベンチマーク作成）
  - [ ] メモリ使用量の測定
  - [ ] 不要な全系列計算の削減
  - [ ] 修正後のパフォーマンス比較
- **完了条件**: 計算時間20%以上短縮を達成
- **状態**: ⏳ 未着手

### Task 4.2: ストリーミングAPI設計（将来拡張）
- **ID**: `streaming-api`
- **優先度**: 🟢 低
- **概要**: リアルタイム更新用のストリーミングAPI設計
- **詳細タスク**:
  - [ ] StreamingCalculatorsクラスの設計
  - [ ] O(1)更新アルゴリズムの実装
  - [ ] 既存APIとの統合設計
  - [ ] 使用例とドキュメントの作成
- **完了条件**: 将来のストリーミング機能の基盤が準備される
- **状態**: ⏳ 未着手

### Task 4.3: ドキュメントと品質保証
- **ID**: `docs-qa`
- **優先度**: 🟡 中
- **概要**: ドキュメント更新と最終品質確認
- **詳細タスク**:
  - [ ] 修正内容の詳細ドキュメント作成
  - [ ] APIリファレンスの更新
  - [ ] 使用例の追加・修正
  - [ ] o3ツールによる再レビュー実施
- **完了条件**: 全ドキュメントが最新状態で品質基準を満たす
- **状態**: ⏳ 未着手

---

## 検証・テストタスク

### Task V.1: 市販チャート互換性テスト
- **ID**: `chart-compatibility`
- **優先度**: 🟡 中
- **概要**: TradingView等との計算結果比較
- **詳細タスク**:
  - [ ] 代表的な銘柄データでの比較テスト
  - [ ] 誤差範囲（±0.1%）の確認
  - [ ] 相違がある場合の原因分析
- **完了条件**: 主要チャートソフトとの整合性確認
- **状態**: ⏳ 未着手

### Task V.2: 回帰テストの実行
- **ID**: `regression-test`
- **優先度**: 🔴 高
- **概要**: 既存機能の動作保証
- **詳細タスク**:
  - [ ] 全既存テストケースの実行
  - [ ] 失敗テストの原因分析と対応
  - [ ] APIインターフェース変更の確認
  - [ ] 互換性問題の解決
- **完了条件**: 既存機能に破壊的変更がないことを確認
- **状態**: ⏳ 未着手

### Task V.3: 総合品質確認
- **ID**: `final-qa`
- **優先度**: 🔴 高
- **概要**: 全修正の最終品質確認
- **詳細タスク**:
  - [ ] o3ツールによる再レビュー
  - [ ] 全要件の達成確認
  - [ ] パフォーマンス目標の達成確認
  - [ ] リリース判定
- **完了条件**: 全品質基準を満たしリリース可能状態
- **状態**: ⏳ 未着手

---

## 進捗管理

### 完了済みタスク: 0/15

### フェーズ別進捗
- **Phase 1 (基盤修正)**: 0/3 タスク完了
- **Phase 2 (MACD修正)**: 0/3 タスク完了  
- **Phase 3 (包括的改善)**: 0/3 タスク完了
- **Phase 4 (最適化)**: 0/3 タスク完了
- **検証・テスト**: 0/3 タスク完了

### 次回着手タスク
1. `calc-base-fix` - Calculator基盤の修正
2. `validation-base` - 共通バリデーション基盤の作成

### マイルストーン
- **Phase 1完了**: 基盤修正完了、MACD修正準備完了
- **Phase 2完了**: MACD致命的バグ修正完了、主要問題解決
- **Phase 3完了**: 全指標の品質向上完了
- **最終完了**: 全要件達成、リリース準備完了

---

## 備考

### 依存関係
- Task 1.1, 1.2 → Task 2.1 (Calculator修正後にMACD修正)
- Task 2.1, 2.2 → Task 2.3 (MACD修正後にテスト強化)
- Phase 1,2,3 → Phase 4 (基本修正完了後に最適化)

### リスク対策
- 各フェーズ完了時に中間テスト実施
- 問題発見時は前フェーズに戻って対応
- 既存APIの互換性を常時監視