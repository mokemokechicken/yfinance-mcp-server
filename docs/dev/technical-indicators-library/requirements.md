# Technical Indicators Library - 要件定義書

## 1. プロジェクト概要

Yahoo Finance APIを活用したテクニカル指標分析ライブラリの開発を行う。プロの投資家が使用する標準的なテクニカル指標を提供し、AIが認識しやすい形式でデータを出力する。

### 1.1 プロジェクトゴール

**今回のスコープでのゴール:**
1. **テクニカル指標ライブラリの作成** - `src/lib`以下にモジュラー設計でライブラリを実装
2. **spike/spike_api.tsからの試験的呼び出し** - 作成したライブラリをspikeファイルから呼び出して動作検証を行う

**具体的な達成目標:**
- コマツ(6301)のテクニカル指標（移動平均線、RSI、MACD）が正常に計算される
- ライブラリとして独立して動作し、他のファイルから呼び出し可能
- spike_api.tsでライブラリの全機能をテスト・検証できる

## 2. 対象範囲

### 2.1 対象銘柄
- 任意の株式銘柄（コマツ 6301で検証）
- 日本株式および世界の主要株式市場

### 2.2 データ取得頻度
- 日次データ（リアルタイムは不要）
- 過去の十分な期間のデータ取得が可能であること

## 3. 機能要件

### 3.1 実装すべきテクニカル指標

**Phase 1（初期実装）:**
- **移動平均線 (Moving Average)**
  - 25日移動平均線
  - 50日移動平均線  
  - 200日移動平均線
- **RSI (相対力指数)**
  - 14日RSI
  - 21日RSI（中期分析用）
- **MACD**
  - MACDライン、シグナルライン、ヒストグラム

**Phase 2（将来拡張）:**
- ボリンジャーバンド
- ストキャスティクス
- ゴールデンクロス・デッドクロス検出
- 出来高分析指標
- VWAP（出来高加重平均価格）

### 3.2 出力要件
- AIが解釈しやすいJSON形式での出力
- ライブラリとしての独立した機能提供
- 将来のMCPツール統合に備えた設計

### 3.3 ライブラリ構造要件
- `src/lib`以下に配置
- 拡張性を考慮したモジュラー設計
- 各指標を独立したモジュールとして実装
- 共通のインターフェースとユーティリティ関数

## 4. 出力データ形式

### 4.1 JSON構造要件
```json
{
  "symbol": "6301.T",
  "companyName": "コマツ",
  "period": "1y",
  "lastUpdated": "2024-12-XX",
  "priceData": {
    "current": 4500,
    "change": 50,
    "changePercent": 1.12
  },
  "technicalIndicators": {
    "movingAverages": {
      "ma25": 4450,
      "ma50": 4400,
      "ma200": 4300
    },
    "rsi": {
      "rsi14": 65.5,
      "rsi21": 62.3
    },
    "macd": {
      "macd": 12.5,
      "signal": 10.2,
      "histogram": 2.3
    }
  },
  "signals": {
    "trend": "upward",
    "momentum": "positive", 
    "strength": "moderate"
  }
}
```

### 4.2 AIの解釈支援
- 各指標の現在値と解釈
- 売買シグナルの自動判定
- トレンドの方向性分析
- 投資判断に必要な要約情報

## 5. 技術要件

### 5.1 既存システムとの統合
- 現在の`yahoo-finance2`ライブラリを活用
- 既存のMCPサーバー構造を維持
- TypeScriptでの型安全性確保

### 5.2 パフォーマンス要件
- 1銘柄の分析処理時間: 3秒以内
- メモリ使用量: 最適化された計算アルゴリズム使用
- エラーハンドリング: Yahoo Finance API障害時の適切な対応

### 5.3 検証・テスト
- spike/spike_api.tsでの動作検証
- 複数銘柄での動作確認
- 指標計算精度の確認

## 6. スケジュールと優先度

### 6.1 Phase 1（検証フェーズ）
1. spike/spike_api.tsでの基本動作確認
2. コマツ(6301)でのデータ取得検証
3. 基本的なテクニカル指標の計算ロジック実装

### 6.2 Phase 2（ライブラリ化） - 今回のスコープ
1. src/lib以下でのライブラリ構造設計
2. モジュラー設計での各指標実装
3. ライブラリの独立テスト

### 6.3 Phase 3（将来の拡張） - 次回以降
1. MCPツールとの統合
2. 追加テクニカル指標の実装
3. シグナル判定ロジックの高度化

## 7. 成功基準

- [ ] コマツ(6301)のテクニカル指標が正常に取得できる
- [ ] AIが理解しやすいJSON形式での出力が実現される
- [ ] 拡張性のあるライブラリ構造が構築される
- [ ] プロ投資家基準のテクニカル指標が正確に計算される
- [ ] ライブラリとして独立して動作する

## 8. リスクと対策

### 8.1 技術的リスク
- Yahoo Finance API の制限や障害
  → エラーハンドリングとフォールバック機能
- 計算精度の問題
  → 標準的な計算式との照合とテスト

### 8.2 運用リスク  
- データ更新頻度の制約
  → 適切なキャッシング戦略
- 処理時間の増加
  → 効率的なアルゴリズムの採用

この要件定義について承認いただけましたら、設計フェーズに進みます。